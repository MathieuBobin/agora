<% @numnow = 0 %>
<% @numthen = 0 %>
<% @numvotes = 0 %>
<% proposals.each do |x| %>
  <%if (x.votes_count >= 5)%>
    <% @numvotes += 1 %>
  <%elsif (x.differencebetween == false) %>
    <% @numnow += 1 %>
  <%else%>
    <% @numthen += 1 %>
  <%end%>
<%end%>

<br><br>
<div id=<%= city.id %> class="my-city">
  <div class="container">
    <% if proposals.count == 0 %>
      <div class='no-proposal'>
        <h3><b>Personne n'a posté de proposition à <%= city.name %> pour le moment.  Change ça en cliquant sur le bouton :</b></h3>
        <p><%= link_to 'Je veux créer ma proposition', new_proposal_path, class: 'btn btn-primary btn-lg' %></p>
      </div>
    <%elsif @numnow == 0 %>
      <div class='no-proposal'>
        <h3><b> Aucune proposition en cours à <%= city.name %>. Change ça en cliquant sur le bouton : </b></h3>
        <p><%= link_to 'Je veux créer ma proposition', new_proposal_path, class: 'btn btn-primary btn-lg' %></p>
      </div>
    <%else%>
      <h3><b>Les propositions en cours : votez pour vos propositions préférées !</b></h3>
      <div class="row">
        <div class="col">
          <div class="card box">
            <div class="card-content">
              <div class="table-responsive">
                <table class="table text-wrap">
                  <tbody>
                    <% proposals.each do |x| %>
                      <%if (x.differencebetween == false) && (x.votes_count < 5) %>
                        <%= render 'cities/ongoing_proposal', x: x %>
                      <%end%>
                    <%end%>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    <%end%>
  </div>

  <div id='completed-proposals' class="container">
    <% if (@numthen == 0) && (@numvotes == 0) %>
      <div class='no-proposal'>
        <h3><b>Pas de proposition terminée à <%= city.name %> pour le moment. </b></h3>
        <br><br>
      </div>
    <%else%>
      <h3><b>Les propositions terminées :</b></h3>
      <div class="row">
        <div class="col">
          <div class="card box">
            <div class="card-content">
              <div class="table-responsive">
                <table class="table text-wrap">
                  <tbody>
                    <% proposals.each do |x| %>
                      <% if (x.differencebetween == true) || (x.votes_count >= 5) %>
                        <%= render 'cities/completed_proposal', x: x %>
                      <%end%>
                    <%end%>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    <%end%>
  </div>
</div>